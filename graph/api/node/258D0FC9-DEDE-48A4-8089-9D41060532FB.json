{
  "id": "258D0FC9-DEDE-48A4-8089-9D41060532FB",
  "title": "blogをdev.toサポートした",
  "raw": ":PROPERTIES:\n:ID:       258D0FC9-DEDE-48A4-8089-9D41060532FB\n:END:\n#+TITLE: blogをdev.toサポートした\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-12-25T07:11:04+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting org-mode devto\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\n[[https://github.com/takeokunn/blog][takeokunn/blog]] でdev.toの記事を管理できるようにしたのでメモしておく。\n\n* 試したこと・やったこと\n** 1. 対応理由整理\n\n[[https://github.com/takeokunn/blog][takeokunn/blog]] は次の3つのターゲットに対してorg-roamでコンテンツ管理をしている。\n\n- Hugo\n  - Repo: https://github.com/takeokunn/blog/tree/main/hugo\n  - Url: https://www.takeokunn.org/\n- Zenn\n  - Repo: https://github.com/takeokunn/blog/tree/main/zenn\n  - Url: https://zenn.dev/takeokunn\n- PDF（Typst）\n  - Repo: https://github.com/takeokunn/blog/tree/main/typst\n  - Url: https://www.takeokunn.org/pdf/phperkaigi-2026-pamphlet.pdf\n\n以前から英語でもブログを書きたいという欲求があった。\nホスティング先はどこがよいのか検討した所、[[https://dev.to/][dev.to]] がなんだかんだ安牌であることがわかったので対応することにした。\n\n** 2. NixでBuildできるようにする\n\n=flake.nix= は以下。\n\nhttps://github.com/takeokunn/blog/blob/main/devto/flake.nix\n\n#+begin_src nix\n  {\n    packages = {\n     build-devto = pkgs.stdenv.mkDerivation {\n       name = \"build-devto\";\n       src = ./.;\n         nativeBuildInputs = with pkgs; [\n           (emacsPkg.pkgs.withPackages (epkgs: (with epkgs.melpaPackages; [ ox-gfm ])))\n         ];\n         buildPhase = ''\n           mkdir -p ./articles\n           emacs --batch --load scripts/ox-devto.el --funcall export-org-devto-files\n         '';\n         installPhase = ''\n           mkdir -p $out\n           # Article Sync Format: articles/{slug}/article.json + article.md\n           for dir in ./articles/*/; do\n             if [ -f \"$dir/article.json\" ]; then\n               cp -r \"$dir\" $out/\n             fi\n           done\n         '';\n       };\n    };\n  }\n#+end_src\n\n=ox-devto.el= を適当に作り、 =ox-gfm= をdev.to用にwrapした。\n\nhttps://github.com/takeokunn/blog/blob/main/devto/scripts/ox-devto.el\n\n#+begin_src emacs-lisp\n  (org-export-define-derived-backend 'devto 'gfm\n    :options-alist\n    '((:devto-tags \"TAGS\" nil nil t)\n      (:devto-description \"DESCRIPTION\" nil nil t)\n      (:devto-id \"DEVTO_ID\" nil nil t)\n      (:devto-slug \"DEVTO_SLUG\" nil nil t)))\n\n  (defun export-org-devto-files ()\n    \"Export all Org files in articles directory to Article Sync format.\"\n    (setq org-publish-timestamp-directory org-devto-timestamp-directory)\n    (let ((org-publish-project-alist\n           `((\"devto\"\n              :recursive t\n              :base-directory ,org-devto-articles-directory\n              :base-extension \"org\"\n              :publishing-directory ,org-devto-output-directory\n              :publishing-function org-devto-publish-to-article-sync))))\n      (org-publish-all t)))\n#+end_src\n** 3. 実際にorg-modeで記事を書く\n\n=DEVTO_ID= や =DEVTO_SLUG= は実際にブログ記事を生成してからじゃないと取得できない値なので注意。\n\n管理画面で手動で記事を作成してから入力するフローになるようだ。\n\n#+begin_src org\n  :PROPERTIES:\n  :ID:       51301ebb-2373-0794-838b-44ab40369fc3\n  :END:\n  ,#+TITLE: devto test1 aaaa\n  ,#+AUTHOR: takeokunn\n  ,#+DESCRIPTION: description\n  ,#+TAGS: sandbox\n  ,#+DEVTO_ID: 3048601\n  ,#+DEVTO_SLUG: devto-test-ol9\n  ,* testhogehogeho\n\n  testfdsafsafafa\n\n  ,#+begin_src bash\n    echo \"hello world\"\n  ,#+end_src\n\n  ,* zzzzzzzzzzz\n\n  ,#+begin_quote\n  fdasfasfa\n  ,#+end_quote\n#+end_src\n** 4. GitHub Actionsで同期する\n\n[[https://zenn.dev/yuta28/articles/dev-github-vscode][dev.toの記事もGitHubで管理してみた - Zenn]] を参考にGitHub Actionsを設定した。\n\n同期してるMarkdownがどういう状況か可視化する為に =devto= ブランチを作成する運用にしてる。\n\nhttps://github.com/takeokunn/blog/tree/devto\n\n#+begin_src yaml\n    build-devto:\n      runs-on: ubuntu-latest\n      needs: ci\n      defaults:\n        run:\n          working-directory: ./devto\n      steps:\n        - uses: actions/checkout@v6\n        - name: Setup nix\n          uses: ./.github/actions/setup-nix\n          with:\n            cachix-auth-token: ${{ secrets.CACHIX_AUTH_TOKEN }}\n        - name: Build devto (Article Sync format)\n          run: nix build .#build-devto\n        - name: Prepare articles directory\n          run: |\n            mkdir -p public/\n            rsync -a --chmod=u+w result/ public/\n        - name: Sync articles to dev.to\n          uses: calvinmclean/article-sync@v1.3.4\n          with:\n            api_key: ${{ secrets.DEV_TO_TOKEN }}\n            article_path: ./devto/public\n            type: synchronize\n            gh_token: ${{ secrets.GITHUB_TOKEN }}\n        - name: Create devto branch\n          uses: peaceiris/actions-gh-pages@v4\n          with:\n            github_token: ${{ secrets.GITHUB_TOKEN }}\n            publish_dir: ./devto/public\n            publish_branch: devto\n            force_orphan: true\n#+end_src\n* 得られた結果・所感\n\n無事テスト記事の投稿ができた。\n\n[[file:../../static/images/72A3B776-C01B-40B2-9F93-54A5B7D41530.png]]\n\n* 今後の展開・検討事項\n\n英語記事を大量に書いて英語力を上げたい。\n",
  "backlinks": []
}