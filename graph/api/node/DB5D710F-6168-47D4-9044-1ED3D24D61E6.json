{
  "id": "DB5D710F-6168-47D4-9044-1ED3D24D61E6",
  "title": "Emacs内でgpg fileがsaveできなくなった時に対応したことメモ",
  "raw": ":PROPERTIES:\n:ID:       DB5D710F-6168-47D4-9044-1ED3D24D61E6\n:mtime:    20231204002930\n:ctime:    20230624130858\n:END:\n#+TITLE: Emacs内でgpg fileがsaveできなくなった時に対応したことメモ\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2023-06-24T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_TAGS: emacs\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* Introduction\n\n自分用のメモです。\n何もしていないのに急にgpg fileがEmacsでsaveできなくなったので調査した。\n\n* 再現手順\n\n1. MacでEmacsを起動する\n2. Emacsでgpg fileを開く\n3. 適当に編集する\n4. =C-x C-s= で =save-buffer= を実行するとsaveできずにhangする\n\n* 原因について\n\n「[[https://stackoverflow.com/questions/76388376/emacs-org-encrypt-entry-hangs-when-file-is-modified][emacs org-encrypt-entry hangs when file is modified - stackoverflow]]」に同様の問題が投稿されていました。\n\nEmacsのcommitに次のような記述が追加されていました。\n[[https://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=1b9812af80b6ceec8418636dbf84c0fbcd3ab694][https://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=1b9812af80b6ceec8418636dbf84c0fbcd3ab694]]\n\n#+begin_example\n  diff --git a/etc/PROBLEMS b/etc/PROBLEMS\n  index c0cb5b0..82ab48f 100644\n  --- a/etc/PROBLEMS\n  +++ b/etc/PROBLEMS\n  @@ -516,6 +516,13 @@ directory copy is ineffective.\n   This is due to an arbitrary limit in certain versions of awk.\n   The solution is to use gawk (GNU awk).\n\n  +*** Saving, via EasyPG, a file encrypted with GnuPG hangs\n  +\n  +This is known to happen with GnuPG v2.4.1.  The only known workaround\n  +is to downgrade to a version of GnuPG older than 2.4.1 (or, in the\n  +future, upgrade to a newer version which solves the problem, when such\n  +a fixed version becomes available)\n  +\n   ,** Problems with hostname resolution\n\n   ,*** Emacs does not know your host's fully-qualified domain name.\n#+end_example\n\nこれによると、GnuPGのversionを下げることによってsave時にhangすることを防げるようです。\n自分の手元では =2.4.0= を使っていますが、同様の問題が起きました。\n\nHomebrewで入れる場合はちゃんとlogin shellにパスを通してあげる必要があります。\n[[https://github.com/takeokunn/dotfiles/commit/55813ec0e37d78a0965a8736b9ff868c6d3bb64a][https://github.com/takeokunn/dotfiles/commit/55813ec0e37d78a0965a8736b9ff868c6d3bb64a]]\n* 対応方法\n\n2023/06/24現在、Homebrewで最新のgpgを入れると =v2.4.0= が降ってきます。\n\n#+begin_src shell\n  $ gpg --version\n  gpg (GnuPG) 2.4.0\n#+end_src\n\n次のようにGnuPGのversionを下げます。\n\n#+begin_src shell\n  $ brew uninstall --ignore-dependencies gpg\n  $ brew install gnupg@2.2\n#+end_src\n\nversionを確認する。\n\n#+begin_src shell\n  $ gpg --version\n  gpg (GnuPG) 2.2.41\n#+end_src\n\n適当なファイルをsaveができればこの問題は解決。\n",
  "backlinks": [
    {
      "title": "GnuPG 2.4.4でEmacsで発生していたバグ修正された",
      "source": "A702DAA2-542D-454E-ABB9-DB4E06A59958"
    }
  ]
}