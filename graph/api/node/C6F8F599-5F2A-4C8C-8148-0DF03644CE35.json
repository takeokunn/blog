{
  "id": "C6F8F599-5F2A-4C8C-8148-0DF03644CE35",
  "title": "Typstテーマを自作した",
  "raw": ":PROPERTIES:\n:ID:       C6F8F599-5F2A-4C8C-8148-0DF03644CE35\n:END:\n#+TITLE: Typstテーマを自作した\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-05-06T22:12:04+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting typst org-mode\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\n[[id:0D13FCEA-F8EC-4729-B700-9A88FD1D5EB9][NixでTypstをBuildしGitHub Pagesでホスティングする]] でTypstから生成したPDFスライドを配信する仕組みを作った。\n今後の登壇は可能な限りTypstから生成するつもりなのでテーマを自作した。\n\n次の要件を満たす必要があった。\n\n- ライトテーマ/ダークテーマなどテーマを簡単に切り替えられるようにする\n- ソースコードのシンタックスハイライトサポート\n- 数式サポート\n\n個人的にDracula Themeが好きなのでDracula Theme風に作る。\n\n* 試したこと・やったこと\n** 1. theme自作\n\n[[https://typst.app/universe/package/polylux/][polylux]] をベースに自作した。[[https://typst.app/universe/package/basic-polylux/][basic-polylux]] あたりを参考に改造した。\n\nシンタックスハイライトは [[https://typst.app/universe/package/codly/][codelst]] に [[https://github.com/dracula/textmate/blob/master/Dracula.tmTheme][Dracula.tmTheme]] を読ませてハイライトしている。\n\n#+begin_src typst\n#import \"@preview/codelst:2.0.2\": sourcecode\n#import \"@preview/polylux:0.4.0\": *\n\n#let blue = rgb(\"#282a36\")\n#let white = rgb(\"#f8f8f2\")\n#let pink = rgb(\"#ff79c6\")\n#let purple = rgb(\"#bd93f9\")\n#let orange = rgb(\"#ffb86c\")\n#let green = rgb(\"#50fa7b\")\n#let gray = rgb(\"#6272a4\")\n\n#let slide-title-header = toolbox.next-heading(h => {\n  show: toolbox.full-width-block.with(fill: blue, inset: 1em)\n  set text(fill: purple, size: 1.2em)\n  strong(h)\n})\n\n#let the-footer(content) = {\n  set text(size: 0.8em)\n  show: pad.with(.5em)\n  set align(bottom)\n  context text(fill: white.lighten(40%), content)\n  h(1fr)\n}\n\n#let outline = toolbox.all-sections((sections, _current) => {\n  enum(tight: false, ..sections)\n})\n\n#let progress-bar = toolbox.progress-ratio(ratio => {\n  set grid.cell(inset: (y: .03em))\n  grid(\n    columns: (ratio * 100%, 1fr),\n    grid.cell(fill: pink)[],\n    grid.cell(fill: purple)[],\n  )\n})\n\n#let new-section(name) = slide({\n  set page(header: none, footer: none)\n  show: pad.with(20%)\n  set text(size: 1.5em)\n  name\n  toolbox.register-section(name)\n  progress-bar\n})\n\n#let focus(body) = context {\n  set page(header: none, footer: none, fill: blue, margin: 2em)\n  set text(fill: orange, size: 1.5em)\n  set align(center)\n  body\n}\n\n#let divider = line(length: 100%, stroke: .1em + pink)\n\n#let setup(\n  footer: none,\n  text-font: \"Migu\",\n  math-font: \"Fira Math\",\n  code-font: \"Fira Code\",\n  text-size: 23pt,\n  body,\n) = {\n  set raw(theme: \"./Dracula.tmTheme\")\n\n  set page(\n    paper: \"presentation-16-9\",\n    fill: blue,\n    margin: (rest: 4em),\n    footer: the-footer(footer),\n    header: slide-title-header,\n  )\n  set text(\n    font: text-font,\n    size: text-size,\n    fill: white,\n  )\n  set strong(delta: 100)\n  show math.equation: set text(font: math-font)\n  show raw: set text(font: code-font)\n  set align(horizon)\n  show emph: it => text(fill: pink, it.body)\n  show heading.where(level: 1): _ => none\n\n  body\n}\n#+end_src\n** 2. flake.nixでBuildする\n\n以下抜粋。\nhttps://github.com/takeokunn/blog/blob/d7501711936b11d3f53c312c2775e20faab35602/typst/flake.nix\n\n#+begin_src nix\n  {\n    pkgs.stdenv.mkDerivation {\n        inherit name;\n        src = ./.;\n        nativeBuildInputs = with pkgs; [\n          typst\n          migu\n          fira-math\n          fira-code\n          (emacsPkg.pkgs.withPackages (epkgs: with epkgs; [ org ox-typst ]))\n        ];\n        buildPhase = ''\n          emacs --batch --load scripts/ox-typst.el --file org/${name}/article.org --funcall org-typst-slide-export-to-typst\n          export TYPST_FONT_PATHS=\"${pkgs.migu}/share/fonts/truetype/migu:${pkgs.fira-math}/share/fonts/opentype:${pkgs.fira-code}/share/fonts/truetype/NerdFonts/FiraCode/\"\n          export TYPST_PACKAGE_PATH=\"${typstPackagesCache}/typst/packages\"\n\n          cp ./themes/dracula.typ org/${name}/dracula.typ\n          cp ./themes/Dracula.tmTheme org/${name}/Dracula.tmTheme\n          typst compile org/${name}/article.typ\n        '';\n        installPhase = ''\n          mkdir -p $out\n          cp org/${name}/article.pdf $out/${name}.pdf\n        '';\n      };\n  }\n#+end_src\n** 3. org-modeでスライドを作成\n\n=#+begin_export typst= 内にtypstを記述する。\n\n#+begin_src org\n  ,#+TYPST: #import \"./dracula.typ\": *\n  ,#+TYPST: #show: setup\n  ,* Title\n\n  スピーカーノートを記述。\n\n  ,#+begin_export typst\n  #slide[\n    #set page(header: none, footer: none, margin: 3em)\n\n    #text(size: 1.3em)[\n      ,,*こんにちは世界*\n    ]\n\n    My subtitle\n\n    #divider\n\n    #set text(size: .8em, weight: \"light\")\n    The Author\n\n    Jan 16, 2025\n\n    Some extra info\n  ]\n  ,#+end_export\n#+end_src\n* 得られた結果・所感\n\nPDFを生成できるようになった。\nhttps://www.takeokunn.org/pdf/example-slide.pdf\n\nfile:../../static/images/2EC21D4B-FC41-44C1-A5E0-8F2E6F326812.jpg\nfile:../../static/images/0C793D17-EBA9-49C1-9679-CC1C9ED4359B.jpg\nfile:../../static/images/5A54F358-F53F-4295-B219-9C7DC400DE7F.jpg\nfile:../../static/images/4CF07E20-20B6-4B4A-838D-C7071F3A2B03.jpg\nfile:../../static/images/4F026E33-FB7C-458D-82CD-4393F0F5297B.jpg\nfile:../../static/images/61370467-F63F-44F7-A8C8-0653BF33F660.jpg\nfile:../../static/images/64AED4DD-9B08-42A0-A4C6-83C0E46328E7.jpg\n\n* 今後の展開・検討事項\n\n今後の発表でガンガン使うことによってtypstに慣れたい。\nまた、ライトテーマの自作やレイアウトテンプレートの充実など自作テーマの幅を広げたい。\n",
  "backlinks": [
    {
      "title": "Typst自作テーマで登壇スライドを作成した",
      "source": "9A373386-769A-4152-BDED-20931CA588BC"
    },
    {
      "title": "Typst SlideのDracula Light Theme作成した",
      "source": "45AEA699-2D94-4CAD-B117-B63661AAB7F1"
    },
    {
      "title": "Typstとpdfpcでプレゼン機能を実現する",
      "source": "B046C3A9-62E8-4DD7-BC71-4DF4FFA34664"
    },
    {
      "title": "Typstとpdfpcでプレゼン機能を実現する",
      "source": "B046C3A9-62E8-4DD7-BC71-4DF4FFA34664"
    }
  ]
}