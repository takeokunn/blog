<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Git on takeokunn's blog</title><link>https://www.takeokunn.org/tags/git/</link><description>Recent content in Git on takeokunn's blog</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Tue, 23 Dec 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://www.takeokunn.org/tags/git/index.xml" rel="self" type="application/rss+xml"/><item><title>gitleaksを導入した</title><link>https://www.takeokunn.org/posts/fleeting/20251222124101-setup_gitleaks/</link><pubDate>Tue, 23 Dec 2025 00:00:00 +0000</pubDate><guid>https://www.takeokunn.org/posts/fleeting/20251222124101-setup_gitleaks/</guid><description>&lt;h2 id="背景-動機"&gt;背景・動機&lt;/h2&gt;
&lt;p&gt;秘密鍵をgit commitしないようにしたいと以前から考えていた。
大体のプロジェクトのCIにsecretlintを導入していたが、手元でもpre-commitでも設定したいと思っていた所、gitleaksなら設定不要で楽に導入できることが分かったので導入した。&lt;/p&gt;
&lt;h2 id="試したこと-やったこと"&gt;試したこと・やったこと&lt;/h2&gt;
&lt;h3 id="0-dot-ツール選定"&gt;0. ツール選定&lt;/h3&gt;
&lt;p&gt;類似ツールにはgit-secrets、trufflehog、secretlintがある。&lt;/p&gt;
&lt;p&gt;次の性質があるツールがよい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nixpkgsにある&lt;/li&gt;
&lt;li&gt;デフォルト設定がしっかりしてる&lt;/li&gt;
&lt;li&gt;CLIで雑に実行できる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://dev.classmethod.jp/articles/gitleaks-commands/"&gt;『Gitleaks』で機密情報の漏洩を防ぐ〜コマンド編〜&lt;/a&gt; を読んでいた所、自分のニーズを満たせることが確認できたので導入を決定した。&lt;/p&gt;
&lt;h3 id="1-dot-home-manager-module作成"&gt;1. home-manager module作成&lt;/h3&gt;
&lt;p&gt;home-manager moduleを自作すると自由度が上がる。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/takeokunn/nixos-configuration/blob/6df4a5955942bff1010b80e3c1bc48af48baebd5/home-manager/modules/gitleaks/default.nix"&gt;https://github.com/takeokunn/nixos-configuration/blob/6df4a5955942bff1010b80e3c1bc48af48baebd5/home-manager/modules/gitleaks/default.nix&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;programs.gitleaks.enable = true&lt;/code&gt; するだけで設定完了する。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-nix" data-lang="nix"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; programs&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gitleaks &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; enable &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; enableGitHook &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; settings &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; extend&lt;span style="color:#f92672"&gt;.&lt;/span&gt;useDefault &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="2-dot-devenvのgit-pre-commit導入"&gt;2. devenvのgit pre-commit導入&lt;/h3&gt;
&lt;p&gt;devenvでgit hookを定義してると、system globalのgit hookを読んでくれないことがわかった。&lt;/p&gt;
&lt;p&gt;devenvでかなりhookを定義してるので、こちらでも明示的にpre-commitを定義している。
&lt;a href="https://devenv.sh/git-hooks/"&gt;https://devenv.sh/git-hooks/&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-nix" data-lang="nix"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{ pkgs&lt;span style="color:#f92672"&gt;,&lt;/span&gt; &lt;span style="color:#f92672"&gt;...&lt;/span&gt; }: {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; git-hooks&lt;span style="color:#f92672"&gt;.&lt;/span&gt;hooks &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; check-merge-conflicts&lt;span style="color:#f92672"&gt;.&lt;/span&gt;enable &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; check-case-conflicts&lt;span style="color:#f92672"&gt;.&lt;/span&gt;enable &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gitleaks &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; enable &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; entry &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;${&lt;/span&gt;pkgs&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gitleaks&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;/bin/gitleaks protect --staged&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="得られた結果-所感"&gt;得られた結果・所感&lt;/h2&gt;
&lt;p&gt;より安全に &lt;code&gt;git commit&lt;/code&gt; できるようになった。&lt;/p&gt;</description></item><item><title>個人的Local環境のGit Branch運用について</title><link>https://www.takeokunn.org/posts/fleeting/20250518144557-local_git_branch_operation/</link><pubDate>Sun, 18 May 2025 00:00:00 +0000</pubDate><guid>https://www.takeokunn.org/posts/fleeting/20250518144557-local_git_branch_operation/</guid><description>&lt;h2 id="背景-動機"&gt;背景・動機&lt;/h2&gt;
&lt;p&gt;複数人で触っているRepoをLocalでGit操作する時、次のような問題が発生していた。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;直pushしてしまった&lt;/li&gt;
&lt;li&gt;意図しない作業ブランチで作業してしまった&lt;/li&gt;
&lt;li&gt;コンフリクト解消ミスで本来必要なコードを消してしまう&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GitHubのBranch RuleやCIなどでミスを防ぐべきだが、そういうのが整っていない環境というのは多々ある。
自衛のために個人的に行っているGit Branch運用について纏めておく。&lt;/p&gt;
&lt;p&gt;当記事の前提は以下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git ClientはMagit&lt;/li&gt;
&lt;li&gt;Default Branchは &lt;code&gt;main&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;GitHubを利用している&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="試したこと-やったこと"&gt;試したこと・やったこと&lt;/h2&gt;
&lt;h3 id="0-dot-方針を決める"&gt;0. 方針を決める&lt;/h3&gt;
&lt;p&gt;基本方針は以下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最新のRemote Branchを常に取得する&lt;/li&gt;
&lt;li&gt;デフォルトがLocal Branchが一切ない状態にする
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;main&lt;/code&gt; Branchすら用意しない&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;作業するタイミング &lt;strong&gt;&lt;strong&gt;のみ&lt;/strong&gt;&lt;/strong&gt; Local Branchを作成する
&lt;ul&gt;
&lt;li&gt;作業が終わったら必ずGit Pushする（Remote管理）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="1-dot-手元から一切のlocal-branchを消す"&gt;1. 手元から一切のLocal Branchを消す&lt;/h3&gt;
&lt;p&gt;次のようなLocal Branchがあったとする。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git branch
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; feature/xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; feature/yyy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; feature/zzz
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;* main
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;origin/main&lt;/code&gt; に移動して、 &lt;code&gt;main&lt;/code&gt; Branch含めすべてのLocal Branchを削除する。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-console" data-lang="console"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git checkout origin/main
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;&lt;/span&gt;$ git branch -D main
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git branch -D feature/xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git branch -D feature/yyy
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ git branch -D feature/zzz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;次のような状態になるとよい。&lt;/p&gt;</description></item></channel></rss>