{
  "id": "0CE9BF34-2CDA-442A-BA54-CA1865C53E07",
  "title": "簡易的なヒューリスティックパーサの自作方法",
  "raw": ":PROPERTIES:\n:ID:       0CE9BF34-2CDA-442A-BA54-CA1865C53E07\n:END:\n#+TITLE: 簡易的なヒューリスティックパーサの自作方法\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-12-23T20:18:08+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\nクローリング結果や業務で使ってるデータベースの値など世の中にはDirtyな値が山のようにある。\n一定のルールで正規化した値を取得したい場合にヒューリスティックパーサが便利。\n\n業務で大量に作ったので作り方についてメモしておく。\n\n* 試したこと・やったこと\n** 0. ヒューリスティックパーサが適切か見極める\n\n目の前の問題の性質がヒューリスティックパーサが適してるか確認する。\n\n- メリット\n  - 不完全・壊れた入力への耐性が高い\n  - 実装の簡単さ\n  - パフォーマンス\n  - 依存関係の排除\n- デメリット\n  - エッジケースに対応しきれない\n  - 偽陽性や偽陰性\n  - 正当性の証明が困難\n\n** 1. テストデータのパターンを用意する\n\nAIにテストケースをyamlで生成させる。\nたとえば次のyamlは文字列から月給の下限と上限を取得するparserを実装する例。\n\n#+begin_src yaml\n  # 年収（年俸）の文字列があるパターン\n  - input: \"300万円～350万円 ※この限りではありません。\"\n    expected:\n      form: \"年収\"\n      min: 3000000\n      max: 3500000\n\n  # 年収の単純な範囲指定パターン\n  - input: \"年俸400万円～500万円\"\n    expected:\n      form: \"年俸\"\n      min: 4000000\n      max: 5000000\n\n  # 月給のパターン\n  - input: \"月給20万円～25万円\"\n    expected:\n      form: \"月給\"\n      min: 200000\n      max: 250000\n\n  - input: \"月給25万3000円\"\n    expected:\n      form: \"月給\"\n      min: 253000\n      max: 253000\n\n  # 時給のパターン\n  - input: \"時給1,500円～2,000円\"\n    expected:\n      form: \"時給\"\n      min: 1500\n      max: 2000\n\n  - input: \"時給1,800円\"\n    expected:\n      form: \"時給\"\n      min: 1800\n      max: 1800\n\n  # 日給のパターン\n  - input: \"日給12,000円～15,000円\"\n    expected:\n      form: \"日給\"\n      min: 12000\n      max: 15000\n\n  - input: \"日給10,000円\"\n    expected:\n      form: \"日給\"\n      min: 10000\n      max: 10000\n#+end_src\n\n** 2. パーサをAIに作らせる\n\n「yamlのinputとexpectedに合うparserを自作して、vitestで実装して」とAIに命令すればよい。\n\n#+begin_src typescript\n  import { describe, it, expect } from \"vitest\";\n  import fs from \"node:fs\";\n  import yaml from \"js-yaml\";\n  import path from \"node:path\";\n  import { parseSalary } from \"./salary\";\n\n  interface TestData {\n    input: string;\n    expected: {\n      form: string | null;\n      min: number | null;\n      max: number | null;\n    };\n  }\n\n  describe(\"parseSalary\", () => {\n    const yamlPath = path.join(__dirname, \"salary.yaml\");\n    const yamlFile = fs.readFileSync(yamlPath, \"utf8\");\n    const testCases = yaml.load(yamlFile) as TestData[];\n\n    testCases.forEach(({ input, expected }) => {\n      it(`should parse \"${input}\" correctly`, () => {\n        const result = parseSalary(input);\n        expect(result).toEqual(expected);\n      });\n    });\n  });\n#+end_src\n* 得られた結果・所感\n\nClaude Codeに大量にヒューリスティックパーサを大量に錬成できた。\n昔の人は手でパーサを書いてたと思うとAIさまざま。\n\n* 今後の展開・検討事項\n\nヒューリスティックパーサよりも厳密性が求められる時にフォーマルなパーサを実装できるようにしておきたい。\n",
  "backlinks": []
}