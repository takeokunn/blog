{
  "id": "1C184C94-166F-4D51-9337-04E20A43E299",
  "title": "docker-compose.ymlのportsについてのメモ",
  "raw": ":PROPERTIES:\n:ID:       1C184C94-166F-4D51-9337-04E20A43E299\n:mtime:    20231204002946\n:ctime:    20221214231958\n:END:\n#+TITLE: docker-compose.ymlのportsについてのメモ\n#+AUTHOR: takeokunn\n#+DESCRIPTION: docker-compose.ymlのportsについてのメモ\n#+DATE: 2019-02-26T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/permanent\n#+HUGO_CATEGORIES: permanent\n#+HUGO_TAGS: docker\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n\nおもしろい挙動をするので記事化する。\n\n中のコード読んでみたい。\n\n#+begin_src yaml\n  version: '3'\n  services:\n    nginx:\n      image: nginx\n      ports:\n        - 0:80\n#+end_src\n\nportを0にするとどうなるだろうか。\n\n#+begin_src shell\n  ~/D/test (*´ω｀*) < docker ps\n  CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES\n  05e0975ea3d1        nginx               \"nginx -g 'daemon of…\"   51 seconds ago      Up 49 seconds       0.0.0.0:32768->80/tcp   test_nginx_1\n#+end_src\n\n~0.0.0.0:32768->80/tcp~ なんと、 ~32768~ にforwardされるのだ。\n\nもう一度 ~docker-compose up~ し直す。\n\n\n#+begin_src shell\n  ~/D/test (*´ω｀*) < docker ps\n  CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES\n  05e0975ea3d1        nginx               \"nginx -g 'daemon of…\"   4 minutes ago       Up 4 seconds        0.0.0.0:32769->80/tcp   test_nginx_1\n#+end_src\n\n~0.0.0.0:32769->80/tcp~ こうなる。不思議だ。\n\nどこかの記事で読んだのだけれども、被らないようにportをforwardingしてくれるそうな。\n\n公式ドキュメントのNoteもおもしろい。\n\n#+begin_quote\nNote: When mapping ports in the HOST:CONTAINER format, you may\nexperience erroneous results when using a container port lower than 60,\nbecause YAML parses numbers in the format xx:yy as a base-60 value. For\nthis reason, we recommend always explicitly specifying your port\nmappings as strings.\n#+end_quote\n\n[[https://docs.docker.com/compose/compose-file/]]\n\n↑のgoogle翻訳。\n\n#+begin_quote\n注意：HOST：CONTAINER形式でポートをマッピングする場合、60未満のコンテナポートを使用すると、YAMLがxx：yyの形式の数値を60進数の値として解析するため、誤った結果が生じる可能性があります。このため、ポートマッピングを常に文字列として明示的に指定することをお勧めします。\n#+end_quote\n",
  "backlinks": []
}