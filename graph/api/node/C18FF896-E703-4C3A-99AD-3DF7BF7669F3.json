{
  "id": "C18FF896-E703-4C3A-99AD-3DF7BF7669F3",
  "title": "digツールはdoggoが便利",
  "raw": ":PROPERTIES:\n:ID:       C18FF896-E703-4C3A-99AD-3DF7BF7669F3\n:END:\n#+TITLE: digツールはdoggoが便利\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-12-24T13:21:22+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting network\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\nインフラ構築する時にdigを叩くことは必須なのだが、2025年にdigコマンドをそのまま使うのは流石に辛い。\nもう少しリッチなものがないか調べた所、doggoが良さそうだったので導入してみた。\n\n* 試したこと・やったこと\n** 0. ツール選定\n\nRust製のツールに [[https://github.com/ogham/dog][dog]] というものがあるが、最終更新が2021年前と期間が空いてる。\n\n後継にあたるツールがないかなと思って調査した所、Golang製の [[https://github.com/mr-karan/doggo][doggo]] というツールがあった。\n\n#+begin_quote\nIt's totally inspired by dog which is written in Rust. I wanted to add some features to it but since I don't know Rust, I found it as a nice opportunity to experiment with writing a DNS Client from scratch in Go myself. Hence the name dog + go => doggo.\n#+end_quote\n\nNixでパッケージングされているし、CLIとしての完成度も高く、アクティブなプロジェクトだったので導入した。\n\n** 1. home-manager module用意\n\n特に設定項目がないのでshell completionだけ有効にしている。\n\n#+begin_src nix\n  {\n    pkgs,\n    lib,\n    config,\n    ...\n  }:\n  let\n    cfg = config.programs.doggo;\n  in\n  with lib;\n  {\n    options.programs.doggo = {\n      enable = mkEnableOption \"Command-line DNS Client for Humans. Written in Golang\";\n      package = mkPackageOption pkgs \"doggo\" { };\n\n      enableBashIntegration = lib.hm.shell.mkBashIntegrationOption { inherit config; };\n\n      enableZshIntegration = lib.hm.shell.mkZshIntegrationOption { inherit config; };\n\n      enableFishIntegration = lib.hm.shell.mkFishIntegrationOption { inherit config; };\n    };\n\n    config = mkIf cfg.enable {\n      home.packages = [ cfg.package ];\n\n      programs = {\n        bash.initExtra = mkIf (cfg.enableBashIntegration && cfg.package != null) ''\n          eval \"$(${getExe cfg.package} completions bash)\"\n        '';\n\n        zsh.initContent = mkIf (cfg.enableZshIntegration && cfg.package != null) ''\n          eval \"$(${getExe cfg.package} completions zsh)\"\n        '';\n\n        fish.interactiveShellInit = mkIf (cfg.enableFishIntegration && cfg.package != null) ''\n          ${getExe cfg.package} completions fish | source\n        '';\n      };\n    };\n  }\n#+end_src\n\nあとは =programs.doggo.enable = true;= で有効にするだけで使えるようになる。\n\n** 2. 実際に使ってみる\n\nhelpを引くとquicやtlsにも対応してることが分かる。\n\n#+begin_src console\n  NAME:\n    doggo üê∂ DNS Client for Humans\n\n  USAGE:\n    doggo [--] [query options] [arguments...]\n\n  VERSION:\n    v1.1.2 - unknown\n\n  EXAMPLES:\n    doggo mrkaran.dev                             Query a domain using defaults.\n    doggo mrkaran.dev CNAME                       Query for a CNAME record.\n    doggo mrkaran.dev MX @9.9.9.9                 Uses a custom DNS resolver.\n    doggo -q mrkaran.dev -t MX -n 1.1.1.1         Using named arguments.\n    doggo mrkaran.dev --aa --ad                   Query with Authoritative Answer and Authenticated Data flags set.\n    doggo mrkaran.dev --cd --do                   Query with Checking Disabled and DNSSEC OK flags set.\n    doggo mrkaran.dev --gp-from Germany           Query using Globalping API from a specific location.\n\n  FREE FORM ARGUMENTS:\n    Supply hostnames, query types, and classes without flags. Example:\n    doggo mrkaran.dev A @1.1.1.1\n\n  TRANSPORT OPTIONS:\n    Specify the protocol with a URL-type scheme.\n    UDP is used if no scheme is specified.\n    @udp://     eg: @1.1.1.1                                                        initiates a UDP query to 1.1.1.1:53.\n    @tcp://     eg: @tcp://1.1.1.1                                                  initiates a TCP query to 1.1.1.1:53.\n    @https://   eg: @https://cloudflare-dns.com/dns-query                           initiates a DOH query to Cloudflare via DoH.\n    @tls://     eg: @tls://1.1.1.1                                                  initiates a DoT query to 1.1.1.1:853.\n    @sdns://    initiates a DNSCrypt or DoH query using a DNS stamp.\n    @quic://    initiates a DOQ query.\n\n  SUBCOMMANDS:\n    completions [bash|zsh|fish]   Generate the shell completion script for the specified shell.\n\n  QUERY OPTIONS:\n    -q, --query=HOSTNAME          Hostname to query the DNS records for (eg mrkaran.dev).\n    -t, --type=TYPE               Type of the DNS Record (A, MX, NS etc).\n    -n, --nameserver=ADDR         Address of a specific nameserver to send queries to (9.9.9.9, 8.8.8.8 etc).\n    -c, --class=CLASS             Network class of the DNS record (IN, CH, HS etc).\n    -x, --reverse                 Performs a DNS Lookup for an IPv4 or IPv6 address. Sets the query type and class to PTR and IN respectively.\n    --any                         Query all supported DNS record types (A, AAAA, CNAME, MX, NS, PTR, SOA, SRV, TXT, CAA).\n\n  RESOLVER OPTIONS:\n    --strategy=STRATEGY           Specify strategy to query nameserver listed in etc/resolv.conf. (all, random, first).\n    --ndots=INT                   Specify ndots parameter. Takes value from /etc/resolv.conf if using the system namesever or 1 otherwise.\n    --search                      Use the search list defined in resolv.conf. Defaults to true. Set --search=false to disable search list.\n    --timeout=DURATION            Specify timeout for the resolver to return a response (e.g., 5s, 400ms, 1m).\n    -4, --ipv4                    Use IPv4 only.\n    -6, --ipv6                    Use IPv6 only.\n    --tls-hostname=HOSTNAME       Provide a hostname for verification of the certificate if the provided DoT nameserver is an IP.\n    --skip-hostname-verification  Skip TLS Hostname Verification in case of DOT Lookups.\n\n  QUERY FLAGS:\n    --aa                          Set Authoritative Answer flag.\n    --ad                          Set Authenticated Data flag.\n    --cd                          Set Checking Disabled flag.\n    --rd                          Set Recursion Desired flag (default: true).\n    --z                           Set Z flag (reserved for future use).\n    --do                          Set DNSSEC OK flag.\n\n  EDNS OPTIONS:\n    --nsid                        Request Name Server Identifier (NSID) to identify the nameserver.\n    --cookie                      Request DNS Cookie for enhanced security and protection against spoofing.\n    --padding                     Request EDNS padding for privacy. Helps mitigate traffic analysis attacks.\n    --ede                         Request Extended DNS Errors for detailed error information.\n    --ecs=SUBNET                  EDNS Client Subnet (e.g., '192.0.2.0/24' or '2001:db8::/32'). Send client subnet for geo-aware responses.\n\n  OUTPUT OPTIONS:\n    -J, --json                    Format the output as JSON.\n    --short                       Short output format. Shows only the response section.\n    --color                       Defaults to true. Set --color=false to disable colored output.\n    --debug                       Enable debug logging.\n    --time                        Shows how long the response took from the server.\n\n  GLOBALPING OPTIONS:\n    --gp-from=Germany             Query using Globalping API from a specific location.\n    --gp-limit=INT                Limit the number of probes to use from Globalping.\n#+end_src\n\n雑に =takeokunn.org= のNSを引くとこんな感じで出力される。\n\n#+begin_src console\n  $ doggo takeokunn.org NS\n  NAME                     TYPE  CLASS  TTL    ADDRESS                  NAMESERVER\n  takeokunn.org.           NS    IN     3600s  bob.ns.cloudflare.com.   192.168.2.1:53\n  takeokunn.org.           NS    IN     3600s  mina.ns.cloudflare.com.  192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  108.162.193.104          192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  172.64.33.104            192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  173.245.59.104           192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  108.162.194.251          192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  162.159.38.251           192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  172.64.34.251            192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2606:4700:58::adf5:3b68  192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2803:f800:50::6ca2:c168  192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2a06:98c1:50::ac40:2168  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2606:4700:50::a29f:26fb  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2803:f800:50::6ca2:c2fb  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2a06:98c1:50::ac40:22fb  192.168.2.1:53\n  takeokunn.org.           NS    IN     3600s  bob.ns.cloudflare.com.   192.168.2.1:53\n  takeokunn.org.           NS    IN     3600s  mina.ns.cloudflare.com.  192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  108.162.193.104          192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  172.64.33.104            192.168.2.1:53\n  bob.ns.cloudflare.com.   A     IN     3041s  173.245.59.104           192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  108.162.194.251          192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  162.159.38.251           192.168.2.1:53\n  mina.ns.cloudflare.com.  A     IN     3366s  172.64.34.251            192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2606:4700:58::adf5:3b68  192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2803:f800:50::6ca2:c168  192.168.2.1:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2a06:98c1:50::ac40:2168  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2606:4700:50::a29f:26fb  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2803:f800:50::6ca2:c2fb  192.168.2.1:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2a06:98c1:50::ac40:22fb  192.168.2.1:53\n  takeokunn.org.           NS    IN     3600s  mina.ns.cloudflare.com.  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  takeokunn.org.           NS    IN     3600s  bob.ns.cloudflare.com.   [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   A     IN     3041s  108.162.193.104          [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   A     IN     3041s  172.64.33.104            [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   A     IN     3041s  173.245.59.104           [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  A     IN     3366s  108.162.194.251          [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  A     IN     3366s  162.159.38.251           [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  A     IN     3366s  172.64.34.251            [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2606:4700:58::adf5:3b68  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2803:f800:50::6ca2:c168  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  bob.ns.cloudflare.com.   AAAA  IN     3041s  2a06:98c1:50::ac40:2168  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2606:4700:50::a29f:26fb  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2803:f800:50::6ca2:c2fb  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n  mina.ns.cloudflare.com.  AAAA  IN     3366s  2a06:98c1:50::ac40:22fb  [2408:210:102:4b00:32be:3bff:fe16:7102]:53\n#+end_src\n\njson出力も可能。\n\n#+begin_src console\n  $ doggo --json takeokunn.org A | jq .responses.[0]\n  {\n    \"answers\": [\n      {\n        \"name\": \"takeokunn.org.\",\n        \"type\": \"A\",\n        \"class\": \"IN\",\n        \"ttl\": \"261s\",\n        \"address\": \"185.199.111.153\",\n        \"status\": \"\",\n        \"rtt\": \"9ms\",\n        \"nameserver\": \"192.168.2.1:53\"\n      },\n      {\n        \"name\": \"takeokunn.org.\",\n        \"type\": \"A\",\n        \"class\": \"IN\",\n        \"ttl\": \"261s\",\n        \"address\": \"185.199.110.153\",\n        \"status\": \"\",\n        \"rtt\": \"9ms\",\n        \"nameserver\": \"192.168.2.1:53\"\n      },\n      {\n        \"name\": \"takeokunn.org.\",\n        \"type\": \"A\",\n        \"class\": \"IN\",\n        \"ttl\": \"261s\",\n        \"address\": \"185.199.108.153\",\n        \"status\": \"\",\n        \"rtt\": \"9ms\",\n        \"nameserver\": \"192.168.2.1:53\"\n      },\n      {\n        \"name\": \"takeokunn.org.\",\n        \"type\": \"A\",\n        \"class\": \"IN\",\n        \"ttl\": \"261s\",\n        \"address\": \"185.199.109.153\",\n        \"status\": \"\",\n        \"rtt\": \"9ms\",\n        \"nameserver\": \"192.168.2.1:53\"\n      }\n    ],\n    \"authorities\": null,\n    \"questions\": [\n      {\n        \"name\": \"takeokunn.org.\",\n        \"type\": \"A\",\n        \"class\": \"IN\"\n      }\n    ]\n  }\n#+end_src\n* 得られた結果・所感\n\ndigよりも圧倒的に読み易くなったし、tlsやquicにも対応してるのはありがたい。\n\n* 今後の展開・検討事項\n\ndigツールは自分でも自作できるのでいつかやってみたい。\n",
  "backlinks": []
}