{
  "id": "9D2C4978-BA6C-4CC3-90D7-B5E4964A2288",
  "title": "EsLintでGlobの挙動で詰まった時のメモ",
  "raw": ":PROPERTIES:\n:ID:       9D2C4978-BA6C-4CC3-90D7-B5E4964A2288\n:mtime:    20231204003032\n:ctime:    20221215015644\n:END:\n#+TITLE: EsLintでGlobの挙動で詰まった時のメモ\n#+AUTHOR: takeokunn\n#+DESCRIPTION: EsLintでGlobの挙動で詰まった時のメモ\n#+DATE: 2019-05-31T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/permanent\n#+HUGO_CATEGORIES: permanent\n#+HUGO_TAGS: eslint\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n\n詰まった内容は以下だ。\n\n#+begin_example\n同じコマンドを実行しているはずなのに出力される結果が違うので困っています。\n開発環境では通って、circleci上ではエラーが出ている状態です。\n\nA: npm run test:lint\nB: ./node_module/.bin/eslint --debug app/javascript/**/*.{vue,ts}\n\n\"scripts\": {\n\"test:lint\": \"eslint --debug app/javascript/**/*.{vue,ts}\"\n}\n#+end_example\n\n~A~ と ~B~ で同じコードを実行しているはずなのでなぜか違う結果を吐き出すのだ。 ~local~ では ~eslint~ が通るけど ~circleci~ ではコケる、といった問題が起きていて困っていた。\n\nちなみに、 ~eslint --debug~ で実行ログをみることができる。\n\nESLint開発者の方と弊社CTOのBTOさんに教えてもらうことによって原因を突きとめることができた。\n\n--------------\n\n原因は、「globの解釈の問題」だ。\n\nそもそもglobとは[[https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%AD%E3%83%96][Wiki]]によるとこんな感じ。\n\n#+begin_quote\nグロブ（英:\nglob）とは主にUnix系環境において、ワイルドカードでファイル名のセットを指定するパターンのことである。\n#+end_quote\n\n今回の場合だと、2種類の解釈のし方がある。\n\n- shellでglobが解釈される\n- npmのglobで解釈される\n\nmacの標準のshellは ~bash~ なのだが、これだとうまくglobを評価してくれないのだ。一方、circleciのコンテナのshellは ~busybox~ だったのでうまくglobを評価してくれた。\n\nつまり、macではちゃんと動いていなかっただけだったのだ。\n\nそこで次のようにglob部分を ~'~ で囲った。\n\n#+begin_src json\n  \"scripts\": {\n      \"test:lint\": \"eslint --debug 'app/javascript/**/*.{vue,ts}'\"\n  }\n#+end_src\n\nそうすることにより、 ~npmのglobで解釈される~ ようになり、正常に動くようになった。\n\n内部的にはこれを使っているみたいだ。\n\n[[https://www.npmjs.com/package/glob]]\n\n--------------\n\nこの世界にはたくさんのshellがあるようだ。\n\n- dash（debian ash）\n- ash\n- busybox\n- fish shell\n- xonsh shell\n- z shell\n- bash\n- etc\n\nUbuntu標準は ~dash~ みたいだ。\n\n#+begin_src shell\n  ~/.emacs.d (*´ω｀*) < ll /bin | grep sh\n  -rwxr-xr-x 1 root root 1.1M  5月  3 22:50 bash\n  -rwxr-xr-x 1 root root 119K  1月 25  2018 dash\n  lrwxrwxrwx 1 root root    4  5月  3 22:50 rbash -> bash\n  lrwxrwxrwx 1 root root    4  3月  3 18:34 sh -> dash\n  lrwxrwxrwx 1 root root    4  3月  3 18:34 sh.distrib -> dash\n  lrwxrwxrwx 1 root root    7  3月  7 05:51 static-sh -> busybox\n#+end_src\n\n~sh~ っていうけど、 ~/bin/sh~ に別の ~shell~ の ~symbolic link~ 貼っているだけのようだ。\n",
  "backlinks": []
}