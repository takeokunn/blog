{
  "id": "5237E27E-BCCE-42D6-8E02-1B5EE1E89B48",
  "title": "aws-sdk-php v3.245.0でBC breakをおこす",
  "raw": ":PROPERTIES:\n:ID:       5237E27E-BCCE-42D6-8E02-1B5EE1E89B48\n:mtime:    20231204002909\n:ctime:    20221214165044\n:END:\n#+TITLE: aws-sdk-php v3.245.0でBC breakをおこす\n#+AUTHOR: takeokunn\n#+DESCRIPTION: AwsClientの引数の配列の変更が入ったので壊れるから注意が必要\n#+DATE: 2022-12-14T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_TAGS: php\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 結論\n\n- ~aws-sdk-php~ の ~v3.245.0~ で ~AwcClient~ のconstructorの引数が変わった\n- ~SqsClient~ などの継承しているclassにも影響が出る\n- Composer.jsonで ~\"aws/aws-sdk-php\": \"^3.0\"~ のように指定しているとversionが上がって事故る\n\n* 現象\n\n2022年11月に ~aws-sdk-php~ の ~v3.245.0~ がリリースされた。\n\n[[https://github.com/aws/aws-sdk-php/releases/tag/3.245.0][https://github.com/aws/aws-sdk-php/releases/tag/3.245.0]]\n\nリリース内容の中に[[https://github.com/aws/aws-sdk-php/pull/2517][Feature bearer token #2517]]という変更があり、これによって ~AwsClient~ の記述のし方が次のように変わる。\n\nbefore:\n#+begin_src php\n  $client = new AwsClient([\n      'version' => 'latest',\n      'region' => $_ENV['AWS_REGION'],\n      'credientials' => [\n          'key' => $_ENV['AWS_ACCESS_KEY_ID'],\n          'secret' => $_ENV['AWS_SECRET_ACCESS_KEY'],\n          'token' => $_ENV['AWS_SESSION_TOKEN'],\n      ]\n  ]);\n#+end_src\n\nafter:\n#+begin_src php\n  $client = new AwsClient([\n      'version' => 'latest',\n      'region' => $_ENV['AWS_REGION'],\n      'token' => $_ENV['AWS_SESSION_TOKEN'],\n      'credientials' => [\n          'key' => $_ENV['AWS_ACCESS_KEY_ID'],\n          'secret' => $_ENV['AWS_SECRET_ACCESS_KEY'],\n      ],\n  ]);\n#+end_src\n\n~AwsClient~ はいろいろなbase classとなっているので呼び出し方に注意が必要になってくる。\n\n[[https://github.com/aws/aws-sdk-php/search?q=%22extends+AwsClient%22][https://github.com/aws/aws-sdk-php/search?q=%22extends+AwsClient%22]]\n",
  "backlinks": []
}