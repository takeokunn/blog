{
  "id": "2E655C72-E102-4646-97BD-E69AEA67CCDF",
  "title": "gitleaksを導入した",
  "raw": ":PROPERTIES:\n:ID:       2E655C72-E102-4646-97BD-E69AEA67CCDF\n:END:\n#+TITLE: gitleaksを導入した\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-12-23T20:50:37+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting git\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\n秘密鍵をgit commitしないようにしたいと以前から考えていた。\n大体のプロジェクトのCIにsecretlintを導入していたが、手元でもpre-commitでも設定したいと思っていた所、gitleaksなら設定不要で楽に導入できることが分かったので導入した。\n\n* 試したこと・やったこと\n** 0. ツール選定\n\n類似ツールにはgit-secrets、trufflehog、secretlintがある。\n\n次の性質があるツールがよい。\n\n- nixpkgsにある\n- デフォルト設定がしっかりしてる\n- CLIで雑に実行できる\n\n[[https://dev.classmethod.jp/articles/gitleaks-commands/][『Gitleaks』で機密情報の漏洩を防ぐ〜コマンド編〜]] を読んでいた所、自分のニーズを満たせることが確認できたので導入を決定した。\n** 1. home-manager module作成\n\nhome-manager moduleを自作すると自由度が上がる。\n\nhttps://github.com/takeokunn/nixos-configuration/blob/6df4a5955942bff1010b80e3c1bc48af48baebd5/home-manager/modules/gitleaks/default.nix\n\n~programs.gitleaks.enable = true~ するだけで設定完了する。\n\n#+begin_src nix\n  {\n    programs.gitleaks = {\n      enable = true;\n      enableGitHook = true;\n      settings = {\n        extend.useDefault = true;\n      };\n    };\n  }\n#+end_src\n** 2. devenvのgit pre-commit導入\n\ndevenvでgit hookを定義してると、system globalのgit hookを読んでくれないことがわかった。\n\ndevenvでかなりhookを定義してるので、こちらでも明示的にpre-commitを定義している。\nhttps://devenv.sh/git-hooks/\n\n#+begin_src nix\n  { pkgs, ... }: {\n    git-hooks.hooks = {\n      check-merge-conflicts.enable = true;\n      check-case-conflicts.enable = true;\n      gitleaks = {\n        enable = true;\n        entry = \"${pkgs.gitleaks}/bin/gitleaks protect --staged\";\n      };\n    };\n  }\n#+end_src\n* 得られた結果・所感\n\nより安全に =git commit= できるようになった。\n\n* 今後の展開・検討事項\n\ngitleaksの設定をrecommendedのみ有効にしてるので、もう少し細かい設定をしてきたい。\n",
  "backlinks": []
}