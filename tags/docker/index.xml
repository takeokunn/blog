<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on takeokunn's blog</title><link>https://www.takeokunn.org/tags/docker/</link><description>Recent content in Docker on takeokunn's blog</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Thu, 09 Feb 2023 09:00:00 +0900</lastBuildDate><atom:link href="https://www.takeokunn.org/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Docker VolumeをCopy/Renameする方法</title><link>https://www.takeokunn.org/posts/fleeting/20230209111810-how_to_copy_and_rename_docker_volume/</link><pubDate>Thu, 09 Feb 2023 09:00:00 +0900</pubDate><guid>https://www.takeokunn.org/posts/fleeting/20230209111810-how_to_copy_and_rename_docker_volume/</guid><description>&lt;h2 id="前提"&gt;前提&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;docker volume&lt;/code&gt; のデフォルトの機能にcopyやrenameはありません。
&lt;a href="https://matsuand.github.io/docs.docker.jp.onthefly/storage/volumes/"&gt;https://matsuand.github.io/docs.docker.jp.onthefly/storage/volumes/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/moby/moby/issues/31154"&gt;Rename docker volume #31154&lt;/a&gt; というissueも立っているが、対応される見込がないです。&lt;/p&gt;
&lt;p&gt;interfaceとして提供してくれていないだけで、実態はDocker File System内どこかにはあるはず。
絶対できるはずだという前提のもと調べてみたらできたのでまとめておきます。&lt;/p&gt;
&lt;h2 id="準備"&gt;準備&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;docker engine&lt;/code&gt; を起動して、 &lt;code&gt;docker volume&lt;/code&gt; を作成する。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker volume create --name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;my-volume
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="copyやrenameのやり方"&gt;CopyやRenameのやり方&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;justincormack/nsenter1&lt;/code&gt; を立ち上げる。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run -it --rm --privileged --pid&lt;span style="color:#f92672"&gt;=&lt;/span&gt;host justincormack/nsenter1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;docker volume&lt;/code&gt; がある場所に移動する。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/ &lt;span style="color:#75715e"&gt;# cd /var/lib/docker/volumes/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;/var/lib/docker/volumes &lt;span style="color:#75715e"&gt;# ls -la | grep my-volume&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;drwx-----x &lt;span style="color:#ae81ff"&gt;3&lt;/span&gt; root root &lt;span style="color:#ae81ff"&gt;4096&lt;/span&gt; Feb &lt;span style="color:#ae81ff"&gt;9&lt;/span&gt; 02:59 my-volume
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;あとは &lt;code&gt;cp&lt;/code&gt; をするなり、 &lt;code&gt;mv&lt;/code&gt; をするなりでよしなに。&lt;/p&gt;
&lt;p&gt;すぐに認識してくれないみたいなので &lt;code&gt;Docker for Mac&lt;/code&gt; に反映するには再起動が必要そう。&lt;/p&gt;</description></item><item><title>fluent-bitをDockerで動かす</title><link>https://www.takeokunn.org/posts/fleeting/20221207173426-run_fluent_bit_docker/</link><pubDate>Wed, 07 Dec 2022 09:00:00 +0900</pubDate><guid>https://www.takeokunn.org/posts/fleeting/20221207173426-run_fluent_bit_docker/</guid><description>&lt;h2 id="プロジェクト構成"&gt;プロジェクト構成&lt;/h2&gt;
&lt;p&gt;次のように適当なディレクトリを作成する。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ tree .
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;├── Dockerfile
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;├── application.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;└── docker-compose.yml
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt; directories, &lt;span style="color:#ae81ff"&gt;3&lt;/span&gt; files
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;FROM&lt;/span&gt; &lt;span style="color:#e6db74"&gt;public.ecr.aws/aws-observability/aws-for-fluent-bit:2.21.3&lt;/span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;COPY&lt;/span&gt; application.conf /fluent-bit/etc/application.conf&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;version&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;3.8&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;fluentbit&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;build&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;command&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;/fluent-bit/bin/fluent-bit&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;-c&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;/fluent-bit/etc/application.conf&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#ae81ff"&gt;./application.conf:/fluent-bit/etc/application.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;application.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cfg" data-lang="cfg"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;[SERVICE]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Flush 5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Log_Level info&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;[INPUT]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Name dummy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Tag *-firelens-*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Dummy {&amp;#34;date&amp;#34;:&amp;#34;2022-01-23T03:10:33.317817Z&amp;#34;,&amp;#34;source&amp;#34;:&amp;#34;stdout&amp;#34;,&amp;#34;log&amp;#34;:&amp;#34;time:2022-01-23T03:10:33+00:00\tprotocol:HTTP/1.1\tstatus:200\tsize:1450\treqsize:150\treferer:-\tvhost:10.10.18.102\treqtime:0.176\tcache:-\truntime:-\t&amp;#34;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;[OUTPUT]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Name stdout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;Match *&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="実行方法"&gt;実行方法&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;docker compose up&lt;/code&gt; を立ち上げると上記の &lt;code&gt;[INPUT]&lt;/code&gt; に記述したdummyのinputが出力される。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ docker compose up
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fluent-bit-sandbox-fluentbit-1 | &lt;span style="color:#f92672"&gt;[&lt;/span&gt;0&lt;span style="color:#f92672"&gt;]&lt;/span&gt; *-firelens-*: &lt;span style="color:#f92672"&gt;[&lt;/span&gt;1668664184.902488203, &lt;span style="color:#f92672"&gt;{&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;2022-01-23T03:10:33.317817Z&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;source&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;stdout&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;log&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;time:2022-01-23T03:10:33+00:00 protocol:HTTP/1.1 status:200 size:1450 reqsize:150 referer:- vhost:10.10.18.102 reqtime:0.176 cache:- runtime:- &amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fluent-bit-sandbox-fluentbit-1 | &lt;span style="color:#f92672"&gt;[&lt;/span&gt;1&lt;span style="color:#f92672"&gt;]&lt;/span&gt; *-firelens-*: &lt;span style="color:#f92672"&gt;[&lt;/span&gt;1668664185.900364801, &lt;span style="color:#f92672"&gt;{&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;2022-01-23T03:10:33.317817Z&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;source&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;stdout&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;log&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;time:2022-01-23T03:10:33+00:00 protocol:HTTP/1.1 status:200 size:1450 reqsize:150 referer:- vhost:10.10.18.102 reqtime:0.176 cache:- runtime:- &amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fluent-bit-sandbox-fluentbit-1 | &lt;span style="color:#f92672"&gt;[&lt;/span&gt;2&lt;span style="color:#f92672"&gt;]&lt;/span&gt; *-firelens-*: &lt;span style="color:#f92672"&gt;[&lt;/span&gt;1668664186.900453923, &lt;span style="color:#f92672"&gt;{&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;2022-01-23T03:10:33.317817Z&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;source&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;stdout&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;log&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;time:2022-01-23T03:10:33+00:00 protocol:HTTP/1.1 status:200 size:1450 reqsize:150 referer:- vhost:10.10.18.102 reqtime:0.176 cache:- runtime:- &amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fluent-bit-sandbox-fluentbit-1 | &lt;span style="color:#f92672"&gt;[&lt;/span&gt;3&lt;span style="color:#f92672"&gt;]&lt;/span&gt; *-firelens-*: &lt;span style="color:#f92672"&gt;[&lt;/span&gt;1668664187.900391678, &lt;span style="color:#f92672"&gt;{&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;2022-01-23T03:10:33.317817Z&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;source&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;stdout&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;log&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt;&lt;span style="color:#e6db74"&gt;&amp;#34;time:2022-01-23T03:10:33+00:00 protocol:HTTP/1.1 status:200 size:1450 reqsize:150 referer:- vhost:10.10.18.102 reqtime:0.176 cache:- runtime:- &amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="解説"&gt;解説&lt;/h2&gt;
&lt;p&gt;特に何も指定せずに &lt;code&gt;docker compose up&lt;/code&gt; をすると &lt;code&gt;/fluent-bit/bin/fluent-bit -c /fluent-bit/etc/fluent-bit.conf&lt;/code&gt; で起動をしている。&lt;/p&gt;</description></item><item><title>docker-compose.ymlのportsについてのメモ</title><link>https://www.takeokunn.org/posts/permanent/20190226214952-docker_compose_yml_ports/</link><pubDate>Tue, 26 Feb 2019 09:00:00 +0900</pubDate><guid>https://www.takeokunn.org/posts/permanent/20190226214952-docker_compose_yml_ports/</guid><description>&lt;p&gt;おもしろい挙動をするので記事化する。&lt;/p&gt;
&lt;p&gt;中のコード読んでみたい。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;version&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#39;3&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;nginx&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;image&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;nginx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;:&lt;span style="color:#ae81ff"&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;portを0にするとどうなるだろうか。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;~/D/test &lt;span style="color:#f92672"&gt;(&lt;/span&gt;*´ω｀*&lt;span style="color:#f92672"&gt;)&lt;/span&gt; &amp;lt; docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;05e0975ea3d1 nginx &lt;span style="color:#e6db74"&gt;&amp;#34;nginx -g &amp;#39;daemon of…&amp;#34;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;51&lt;/span&gt; seconds ago Up &lt;span style="color:#ae81ff"&gt;49&lt;/span&gt; seconds 0.0.0.0:32768-&amp;gt;80/tcp test_nginx_1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;0.0.0.0:32768-&amp;gt;80/tcp&lt;/code&gt; なんと、 &lt;code&gt;32768&lt;/code&gt; にforwardされるのだ。&lt;/p&gt;
&lt;p&gt;もう一度 &lt;code&gt;docker-compose up&lt;/code&gt; し直す。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;~/D/test &lt;span style="color:#f92672"&gt;(&lt;/span&gt;*´ω｀*&lt;span style="color:#f92672"&gt;)&lt;/span&gt; &amp;lt; docker ps
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;05e0975ea3d1 nginx &lt;span style="color:#e6db74"&gt;&amp;#34;nginx -g &amp;#39;daemon of…&amp;#34;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;4&lt;/span&gt; minutes ago Up &lt;span style="color:#ae81ff"&gt;4&lt;/span&gt; seconds 0.0.0.0:32769-&amp;gt;80/tcp test_nginx_1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;0.0.0.0:32769-&amp;gt;80/tcp&lt;/code&gt; こうなる。不思議だ。&lt;/p&gt;
&lt;p&gt;どこかの記事で読んだのだけれども、被らないようにportをforwardingしてくれるそうな。&lt;/p&gt;
&lt;p&gt;公式ドキュメントのNoteもおもしろい。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: When mapping ports in the HOST:CONTAINER format, you may
experience erroneous results when using a container port lower than 60,
because YAML parses numbers in the format xx:yy as a base-60 value. For
this reason, we recommend always explicitly specifying your port
mappings as strings.&lt;/p&gt;</description></item></channel></rss>