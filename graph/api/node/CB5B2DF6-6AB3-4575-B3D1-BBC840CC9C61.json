{
  "id": "CB5B2DF6-6AB3-4575-B3D1-BBC840CC9C61",
  "title": "個人的sketchybar設定",
  "raw": ":PROPERTIES:\n:ID:       CB5B2DF6-6AB3-4575-B3D1-BBC840CC9C61\n:END:\n#+TITLE: 個人的sketchybar設定\n#+AUTHOR: takeokunn\n#+DESCRIPTION: description\n#+DATE: 2025-11-30T13:21:51+0900\n#+HUGO_BASE_DIR: ../../\n#+HUGO_CATEGORIES: fleeting\n#+HUGO_SECTION: posts/fleeting\n#+HUGO_TAGS: fleeting sketchybar nix\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n* 背景・動機\n\n[[id:3BB6D87A-A064-45A3-AC62-E75E8B61DBFB][個人的Aerospace設定]] に続き、sketchybarの設定もしたのでメモしておく。\n\n大体の対応は公式ドキュメントを元にClaude Codeに対応させた。\n\nhttps://felixkratz.github.io/SketchyBar/\n\n* 試したこと・やったこと\n** 1. 完成イメージと設計方針\n\n世の中のsketchybarのサンプルを作成して、こんな感じで作る目論見を立てた。\n\n- Hack Nerd Font: アイコンとラベル用\n- SF Pro: Appleロゴ用（macOS標準搭載）\n\n#+begin_src console\n  ┌─────────────────────────────────────────────────────────────────────────┐\n  │ [􀣺] [1 2 3 4 5 6 7 8 9 0] Firefox  |  󰻠 5% 󰍛 42% | 󰖩 Home | 󰕾 50% | 󰁹 85% | 󰃭 01/15 Mon 󰥔 14:30 │\n  └─────────────────────────────────────────────────────────────────────────┘\n#+end_src\n\nまた、すべてをdracula themeに寄せるのでカラーパレットをAIに作らせた。\n\n#+begin_src nix\n  colors = {\n    background = \"0xff282a36\";\n    backgroundTransparent = \"0xcc282a36\";\n    currentLine = \"0xff44475a\";\n    foreground = \"0xfff8f8f2\";\n    comment = \"0xff6272a4\";\n    cyan = \"0xff8be9fd\";\n    green = \"0xff50fa7b\";\n    orange = \"0xffffb86c\";\n    pink = \"0xffff79c6\";\n    purple = \"0xffbd93f9\";\n    red = \"0xffff5555\";\n    yellow = \"0xfff1fa8c\";\n    transparent = \"0x00000000\";\n    black = \"0xff21222c\";\n  };\n#+end_src\n** 2. 基本設定\n*** 2.1. home-manager設定\n\nhome-manager moduleで定義されているので ~enable=true~ するだけで入る。\n\nhttps://github.com/nix-community/home-manager/blob/master/modules/programs/sketchybar.nix\n\n#+begin_src nix\n  programs.sketchybar = {\n    enable = pkgs.stdenv.isDarwin;\n  };\n#+end_src\n\n*** 2.2. バー設定\n\nアイランドスタイル（角丸、マージン、ぼかし効果）でMacBook Proのノッチに対応している。\n\n#+begin_src bash\nbar=(\n  height=40\n  color=\"$BACKGROUND_TRANSPARENT\"\n  shadow=on\n  position=top\n  sticky=on\n  padding_left=8\n  padding_right=8\n  margin=8\n  corner_radius=12\n  blur_radius=30\n  notch_width=200\n  y_offset=4\n)\nsketchybar --bar \"${bar[@]}\"\n#+end_src\n*** 2.3. デフォルト設定\n\n全アイテムに適用されるデフォルトスタイルを設定している。\n\n#+begin_src bash\ndefault=(\n  icon.font=\"Hack Nerd Font:Bold:14.0\"\n  icon.color=\"$FOREGROUND\"\n  label.font=\"Hack Nerd Font:Bold:12.0\"\n  label.color=\"$FOREGROUND\"\n  background.color=\"$TRANSPARENT\"\n  background.corner_radius=8\n  background.height=28\n)\nsketchybar --default \"${default[@]}\"\n#+end_src\n** 3. 左側アイテム\n*** 3.1. Appleロゴ\n\n左端にAppleロゴを配置している。クリックでsketchybar全体を更新する。\n\n#+begin_src bash\nsketchybar --add item apple_logo left \\\n           --set apple_logo \\\n                 icon=\"􀣺\" \\\n                 icon.font=\"SF Pro:Bold:16.0\" \\\n                 icon.color=\"$PURPLE\" \\\n                 background.color=\"$CURRENT_LINE\" \\\n                 background.corner_radius=10 \\\n                 background.height=28 \\\n                 padding_left=8 \\\n                 padding_right=4 \\\n                 click_script=\"sketchybar --update\"\n#+end_src\n*** 3.2. ワークスペース表示\n\nAeroSpaceと連携して現在のワークスペース状態を表示している。\n\n**** 3.2.1. カスタムイベント\n\nAerospaceからワークスペース変更通知を受け取るためのカスタムイベントを登録している。\n\n#+begin_src bash\nsketchybar --add event aerospace_workspace_change\n#+end_src\n\nAerospace側の設定（ ~aerospace.toml~ ）では次のように連携：\n\n#+begin_src toml\nexec-on-workspace-change = [\n  '/bin/bash', '-c',\n  'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE'\n]\n#+end_src\n\n**** 3.2.2. ワークスペースプラグイン\n\n各ワークスペースの状態に応じて表示を切り替えている。\n\n#+begin_src bash\nAEROSPACE=\"/run/current-system/sw/bin/aerospace\"\n\n# 自分のspace ID（space.1, space.2, ... から数字を抽出）\nSID=$(echo \"$NAME\" | sed 's/space\\.//')\n\n# フォーカス中のワークスペースを取得\nif [ -n \"$FOCUSED_WORKSPACE\" ]; then\n  FOCUSED=\"$FOCUSED_WORKSPACE\"\nelse\n  FOCUSED=$(\"$AEROSPACE\" list-workspaces --focused 2>/dev/null || echo \"1\")\nfi\n\nif [ \"$SID\" = \"$FOCUSED\" ]; then\n  # フォーカス中: 紫背景\n  sketchybar --set \"$NAME\" \\\n    background.color=${colors.purple} \\\n    icon.color=${colors.background}\nelse\n  WINDOWS=$(\"$AEROSPACE\" list-windows --workspace \"$SID\" 2>/dev/null | wc -l | tr -d ' ')\n  if [ \"$WINDOWS\" -gt 0 ]; then\n    # ウィンドウあり: 白文字\n    sketchybar --set \"$NAME\" \\\n      background.color=${colors.transparent} \\\n      icon.color=${colors.foreground}\n  else\n    # ウィンドウなし: グレー文字\n    sketchybar --set \"$NAME\" \\\n      background.color=${colors.transparent} \\\n      icon.color=${colors.comment}\n  fi\nfi\n#+end_src\n\n**** 3.2.3. ワークスペース表示設定\n\n1-10のワークスペースをループで生成している。ワークスペース10は「0」と表示している。\n\n#+begin_src bash\nSPACE_ICONS=(\"1\" \"2\" \"3\" \"4\" \"5\" \"6\" \"7\" \"8\" \"9\" \"10\")\n\nfor i in \"${!SPACE_ICONS[@]}\"; do\n  sid=\"${SPACE_ICONS[$i]}\"\n  if [ \"$sid\" = \"10\" ]; then\n    display_icon=\"0\"\n  else\n    display_icon=\"$sid\"\n  fi\n\n  sketchybar --add item space.$sid left \\\n             --set space.$sid \\\n                   icon=\"$display_icon\" \\\n                   icon.font=\"Hack Nerd Font:Bold:14.0\" \\\n                   icon.padding_left=8 \\\n                   icon.padding_right=8 \\\n                   background.corner_radius=8 \\\n                   background.height=28 \\\n                   click_script=\"aerospace workspace $sid\" \\\n                   script=\"${aerospacePlugin}\" \\\n                   update_freq=1 \\\n             --subscribe space.$sid aerospace_workspace_change\ndone\n#+end_src\n\n**** 3.2.4. ブラケット（グループ化）\n\n正規表現で ~space.1~ 〜 ~space.10~ をグループ化している。\n\n#+begin_src bash\nsketchybar --add bracket spaces_bracket '/space\\..*/' \\\n           --set spaces_bracket \\\n                 background.color=\"$CURRENT_LINE\" \\\n                 background.corner_radius=10 \\\n                 background.height=28\n#+end_src\n\n**** 3.2.5. 初期化処理\n\nsketchybar起動時に現在のワークスペースを取得して初期状態を設定している。\n\n#+begin_src bash\nAEROSPACE=\"/run/current-system/sw/bin/aerospace\"\nFOCUSED=$(\"$AEROSPACE\" list-workspaces --focused 2>/dev/null || echo \"1\")\nsketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=\"$FOCUSED\"\n\nsketchybar --update\n#+end_src\n*** 3.3. フロントアプリ\n\n~front_app_switched~ イベントで現在のアプリケーション名を表示している。\n\n#+begin_src bash\nif [ \"$SENDER\" = \"front_app_switched\" ]; then\n  sketchybar --set \"$NAME\" label=\"$INFO\"\nfi\n#+end_src\n\n#+begin_src bash\nsketchybar --add item front_app left \\\n           --set front_app \\\n                 icon.drawing=off \\\n                 label.font=\"Hack Nerd Font:Bold:12.0\" \\\n                 label.color=\"$FOREGROUND\" \\\n                 script=\"${frontAppPlugin}\" \\\n           --subscribe front_app front_app_switched\n#+end_src\n** 4. 右側アイテム\n\nシステム情報を表示する各種プラグインを実装した。\n\n*** 4.1. CPU使用率\n\n~top~ コマンドでCPU使用率を取得している。\n\n#+begin_src bash\nCPU=$(top -l 1 -n 0 | grep \"CPU usage\" | awk '{print $3}' | tr -d '%')\nsketchybar --set \"$NAME\" label=\"$CPU%\"\n#+end_src\n\n#+begin_src bash\nsketchybar --add item cpu right \\\n           --set cpu \\\n                 icon=\"󰻠\" \\\n                 icon.color=\"$CYAN\" \\\n                 script=\"${cpuPlugin}\" \\\n                 update_freq=5\n#+end_src\n\n*** 4.2. メモリ使用率\n\n~memory_pressure~ コマンドでシステムメモリの使用率を取得している。\n\n#+begin_src bash\nMEMORY=$(memory_pressure | grep \"System-wide memory free percentage:\" | awk '{print 100-$5}' | tr -d '%')\nsketchybar --set \"$NAME\" label=\"$MEMORY%\"\n#+end_src\n\n#+begin_src bash\nsketchybar --add item memory right \\\n           --set memory \\\n                 icon=\"󰍛\" \\\n                 icon.color=\"$GREEN\" \\\n                 script=\"${memoryPlugin}\" \\\n                 update_freq=5\n#+end_src\n\n*** 4.3. Wi-Fi\n\n~ipconfig getsummary~ で接続中のSSIDを表示している。\nmacOS Sonoma以降ではセキュリティの観点からSSID情報が ~<redacted>~ としてマスクされることがある。\n\n#+begin_src bash\nSSID=$(ipconfig getsummary en0 2>/dev/null | grep \"^  SSID\" | awk -F ' : ' '{print $2}')\n\nif [ -z \"$SSID\" ]; then\n  sketchybar --set \"$NAME\" icon.color=${colors.red} label=\"Off\"\nelse\n  sketchybar --set \"$NAME\" icon.color=${colors.cyan} label=\"$SSID\"\nfi\n#+end_src\n\n#+begin_src bash\nsketchybar --add item wifi right \\\n           --set wifi \\\n                 icon=\"󰖩\" \\\n                 icon.color=\"$CYAN\" \\\n                 script=\"${wifiPlugin}\" \\\n                 update_freq=30 \\\n           --subscribe wifi wifi_change\n#+end_src\n\n*** 4.4. 音量\n\nAppleScriptで音量設定を取得している。\n\n#+begin_src bash\nVOLUME=$(osascript -e 'output volume of (get volume settings)')\nMUTED=$(osascript -e 'output muted of (get volume settings)')\n\nif [ \"$MUTED\" = \"true\" ]; then\n  ICON=\"󰖁\"\n  sketchybar --set \"$NAME\" icon=\"$ICON\" label=\"mute\"\nelse\n  if [ \"$VOLUME\" -ge 70 ]; then\n    ICON=\"󰕾\"\n  elif [ \"$VOLUME\" -ge 30 ]; then\n    ICON=\"󰖀\"\n  else\n    ICON=\"󰕿\"\n  fi\n  sketchybar --set \"$NAME\" icon=\"$ICON\" label=\"$VOLUME%\"\nfi\n#+end_src\n\n#+begin_src bash\nsketchybar --add item volume right \\\n           --set volume \\\n                 icon=\"󰕾\" \\\n                 icon.color=\"$PINK\" \\\n                 script=\"${volumePlugin}\" \\\n                 update_freq=10 \\\n           --subscribe volume volume_change\n#+end_src\n\n*** 4.5. バッテリー\n\n~pmset~ でバッテリー残量と充電状態を取得している。\n\n#+begin_src bash\nPERCENTAGE=$(pmset -g batt | grep -Eo \"[0-9]+%\" | cut -d% -f1)\nCHARGING=$(pmset -g batt | grep 'AC Power')\n\ncase ${PERCENTAGE} in\n  100)        ICON=\"󰁹\" ;;\n  9[0-9])     ICON=\"󰂂\" ;;\n  8[0-9])     ICON=\"󰂁\" ;;\n  7[0-9])     ICON=\"󰂀\" ;;\n  6[0-9])     ICON=\"󰁿\" ;;\n  5[0-9])     ICON=\"󰁾\" ;;\n  4[0-9])     ICON=\"󰁽\" ;;\n  3[0-9])     ICON=\"󰁼\" ;;\n  2[0-9])     ICON=\"󰁻\" ;;\n  1[0-9])     ICON=\"󰁺\" ;;\n  *)          ICON=\"󰂎\" ;;\nesac\n\nif [ -n \"$CHARGING\" ]; then\n  ICON=\"󰂄\"\n  COLOR=\"${colors.green}\"\nelif [ \"$PERCENTAGE\" -le 20 ]; then\n  COLOR=\"${colors.red}\"\nelse\n  COLOR=\"${colors.green}\"\nfi\n\nsketchybar --set \"$NAME\" icon=\"$ICON\" icon.color=\"$COLOR\" label=\"$PERCENTAGE%\"\n#+end_src\n\n#+begin_src bash\nsketchybar --add item battery right \\\n           --set battery \\\n                 icon=\"󰁹\" \\\n                 icon.color=\"$GREEN\" \\\n                 script=\"${batteryPlugin}\" \\\n                 update_freq=60 \\\n           --subscribe battery power_source_change system_woke\n#+end_src\n\n*** 4.6. 日時表示\n\n日付と時刻を別々のアイテムとして表示している。\n\n#+begin_src bash\nsketchybar --add item date right \\\n           --set date \\\n                 icon=\"󰃭\" \\\n                 icon.color=\"$ORANGE\" \\\n                 script=\"sketchybar --set \\$NAME label=\\\"\\$(date '+%m/%d %a')\\\"\" \\\n                 update_freq=60\n\nsketchybar --add item time right \\\n           --set time \\\n                 icon=\"󰥔\" \\\n                 icon.color=\"$YELLOW\" \\\n                 script=\"sketchybar --set \\$NAME label=\\\"\\$(date '+%H:%M')\\\"\" \\\n                 update_freq=30\n#+end_src\n* 得られた結果・所感\n\nほぼイメージとおりのものができた。\n\n[[file:../../static/images/4027BCF1-B920-4748-B66A-8F5FDD15CF09.png]]\n\n* 今後の展開・検討事項\n\n部分的に少し左寄りや右寄りになってしまっている部分を調整する。\n",
  "backlinks": []
}