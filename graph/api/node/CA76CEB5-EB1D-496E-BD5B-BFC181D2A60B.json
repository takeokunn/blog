{
  "id": "CA76CEB5-EB1D-496E-BD5B-BFC181D2A60B",
  "title": "Ubuntu FirefoxをEmacs Keybindにする",
  "raw": ":PROPERTIES:\n:ID:       CA76CEB5-EB1D-496E-BD5B-BFC181D2A60B\n:mtime:    20231204003018\n:ctime:    20221215013728\n:END:\n#+TITLE: Ubuntu FirefoxをEmacs Keybindにする\n#+AUTHOR: takeokunn\n#+DESCRIPTION: Ubuntu FirefoxをEmacs Keybindにする\n#+DATE: 2019-04-13T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/permanent\n#+HUGO_CATEGORIES: permanent\n#+HUGO_TAGS: ubuntu\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n\n普段Chromeを使っているのだが、外で作業するとき電池の消費量が異常だったのでFirefoxの環境も整備する必要が出てきた。\n\nしかしながら、Emacs脳である自分にはネットサーフィンもEmacsでしたいという欲求が非常に強い。\n\nChromeには[[https://chrome.google.com/webstore/detail/chromemacs/kfdibhbheajeacnkkakomaliggbgndcf][Chromemacs]]という拡張があるが、Firefoxにはなかったのでなんとかしてみた。\n\n--------------\n\n次の記事を参考した。\n\n[[https://qiita.com/mooz@github/items/c5f25f27847333dd0b37][xkeysnail - もうひとつの Linux 向けキーリマッパ]]\n\n#+begin_quote\nFirefox が Quantum になり、旧来の XUL\nベースのアドオンは動作しなくなった。新たな拡張機能の機構である\nWebExtensions ではキーボードショートカットに関する API\nが大幅に制限され、ぼくは拙作のアドオン KeySnail のWebExtensions\n化を諦めた。\n#+end_quote\n\nこの筆者も同じことを考えていて、同じように辛さを感じているようだ。\n\nこの ~xkeysnail~ は ~Firefoxのplugin~ ではなくて、 ~Linuxのuinputを取得して任意のkeyに変換する~ ということをやっている。\n\n[[https://github.com/mooz/xkeysnail][mooz/xkeysnail]] の ~README.md~ に導入方法が書いてある。\n\n自分の ~.config.py~ は以下。\n\n#+begin_src python\n  # -*- coding: utf-8 -*-\n\n  import re\n  from xkeysnail.transform import *\n\n  define_conditional_modmap(re.compile(r'Firefox'), {\n      Key.CAPSLOCK: Key.LEFT_CTRL,\n  })\n\n  define_keymap(re.compile(\"Firefox\"), {\n      # change tab\n      K(\"C-f\"): K(\"C-Tab\"),\n      K(\"C-b\"): K(\"C-Shift-Tab\"),\n\n      # search\n      K(\"C-s\"): K(\"C-f\"),\n      K(\"C-s\"): K(\"C-g\"),\n      K(\"C-r\"): K(\"C-Shift-g\"),\n\n      # private window\n      K(\"C-Shift-n\"): K(\"C-Shift-p\"),\n\n      # up/down\n      K(\"C-n\"): K(\"DOWN\"),\n      K(\"C-p\"): K(\"UP\"),\n      K(\"C-v\"): K(\"SPACE\"),\n\n      K(\"C-g\"): {\n          # change page\n          K(\"C-b\"): K(\"C-LEFT_BRACE\"),\n          K(\"C-f\"): K(\"C-RIGHT_BRACE\"),\n\n          # reload\n          K(\"C-r\"): K(\"C-r\"),\n\n          # paste\n          K(\"C-v\"): K(\"C-v\"),\n\n          # close\n          K(\"C-w\"): K(\"C-w\"),\n\n          # close\n          K(\"C-t\"): K(\"C-Shift-t\"),\n      }\n  }, \"Firefox\")\n#+end_src\n\n~Firefox~ のみ反応してほしいのでこのような設定にした。\n\n[[https://github.com/takeokunn/dotfiles/blob/master/modules/xkeysnail/dot.config.py][takeokunn/dotfiles/blob/master/modules/xkeysnail/dot.config.py]]で管理をしている。\n\nあとは、 ~sudo xkeysnail ~/.config.py~ をたたけば有効になる。\n\n--------------\n\nついでにserviceにも登録しておく。\n\n~/etc/systemd/system/xkeysnail.service~:\n\n#+begin_src conf\n  [Unit]\n  Description=xkeysnail\n\n  [Service]\n  KillMode=process\n  ExecStart=/usr/local/bin/xkeysnail /home/take/.config.py\n  ExecStartPre=/usr/bin/xhost +SI:localuser:root\n  Type=simple\n  Restart=always\n\n  # Update DISPLAY to be the same as `echo $DISPLAY` on your graphical terminal.\n  Environment=DISPLAY=:0\n\n  [Install]\n  WantedBy=default.target\n#+end_src\n\n~ExecStartPre~/usr/bin/xhost +SI:localuser:root~ をしないとどうも ~Xlib.error.DisplayConnectionError: Can't connect to display \":0.0\": b'No protocol specified\\n'~ というエラーが出る。\n\n以下を叩いて終わり。\n\n#+begin_example\n$ sudo service xkeysnail enabled\n$ sudo service xkeysnail start\n#+end_example\n\n--------------\n\nこれで ~Firefox~ も ~Emacs~ のように操作ができるようになった。最高。\n\n微妙に融通の効かない部分とかあるので細かい調整をどんどんしていきたい。\n\n~Firefox Quantum~ の ~Key API~ がハックしや少なってくれることを祈るばかり。\n",
  "backlinks": []
}