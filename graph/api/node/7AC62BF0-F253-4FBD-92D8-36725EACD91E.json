{
  "id": "7AC62BF0-F253-4FBD-92D8-36725EACD91E",
  "title": "npm libraryのbuild formatについて",
  "raw": ":PROPERTIES:\n:ID:       7AC62BF0-F253-4FBD-92D8-36725EACD91E\n:mtime:    20231204003001\n:ctime:    20221215001851\n:END:\n#+TITLE: npm libraryのbuild formatについて\n#+AUTHOR: takeokunn\n#+DESCRIPTION: npm libraryのbuild formatについて\n#+DATE: 2019-03-17T09:00:00+09:00\n#+HUGO_BASE_DIR: ../../\n#+HUGO_SECTION: posts/permanent\n#+HUGO_CATEGORIES: permanent\n#+HUGO_TAGS: npm\n#+HUGO_DRAFT: false\n#+STARTUP: fold\n\n半年前くらいにnpm package作ってみたいなぁと思って作ってみた時学んだことをまとめていく。\n\n次の記事でだいたい理解できたのだが、実際にやってみて細かいところでつまずた部分を書いていく。\n\n- [[https://qiita.com/TsutomuNakamura/items/f943e0490d509f128ae2][初めてのnpmパッケージ公開]]\n- [[https://qiita.com/fnobi/items/f6b1574fb9f4518ed520][3分でできるnpmモジュール]]\n\nちなみに、repoは [[https://github.com/takeokunn/businesh][takeokunn/businesh]] で、ビジネッシュ翻訳してくれるようなゴミみたいなpackageだ。意外とdownloadがあるのウケる。\n\n#+begin_src js\n  const before_text = '任意の文字列をビジネッシュ・テキストに変換するライブラリです。';\n  businesh.translate(before_text)\n      .then(after_text => {\n          // 半強制のコンテクストをハイクオリティなビジネス的サティスファクション・テキストにコンバートフレキシブルに対応するフィジビリティスタディって、この前読んだビジネス書に書いてあった、実例もたくさんある。\n          console.log(after_text)\n      })\n      .catch(err => console.log(err));\n#+end_src\n\n--------------\n\n~npm~ のpackageと一口に言っても、 ~server side javascript~ なのか、 ~frontend javascript~ なのかで毛色が違う。通常次のようにライブラリを呼び出す。\n\nfrontend:\n\n#+begin_src js\n  import businesh from 'businesh';\n#+end_src\n\nserver side:\n\n#+begin_src js\n  const businesh = require('businesh');\n#+end_src\n\n上記のように呼び出すには、次のようにpackageを提供する必要がある。\n\nfrontend:\n\n#+begin_src js\n  export { businesh };\n#+end_src\n\nserver side:\n\n#+begin_src js\n  exports.businesh = businesh;\n#+end_src\n\n~javascript~ の ~module~ には主に4種類ある。\n\n- AMD\n- CommonJS\n- ES\n- UMD\n\nこの辺の記事が参考になる。\n\n- [[https://qiita.com/chuck0523/items/1868a4c04ab4d8cdfb23][[意訳]初学者のためのJavaScriptモジュール講座 #Part1]]\n- [[https://www.davidbcalhoun.com/2014/what-is-amd-commonjs-and-umd/][What is AMD, CommonJS, and UMD?]]\n- [[https://auth0.com/blog/javascript-module-systems-showdown/][JavaScript Module Systems Showdown: CommonJS vs AMD vs ES2015]]\n\n~bundler~ のbuild optionで解決できる。 ~rollup~ を使っているので次のように設定すればよい。\n\n[[https://github.com/takeokunn/businesh/blob/master/rollup.config.js][takeokunn/businesh/blob/master/rollup.config.js]]:\n\n#+begin_src js\n  import babel from 'rollup-plugin-babel';\n\n  const default_config = {\n      input: 'src/main.js',\n      moduleName: 'businesh',\n      plugins: [babel({ exclude: 'node_modules/**', runtimeHelpers: true })]\n  };\n\n  export default [\n      {\n          ...default_config,\n          output: {\n              file: 'dist/bundle.cjs.js',\n              format: 'cjs',\n              sourcemap: true\n          }\n      },\n      {\n          ...default_config,\n          output: {\n              file: 'dist/bundle.es.js',\n              format: 'es',\n              sourcemap: true\n          }\n      },\n      {\n          ...default_config,\n          output: {\n              file: 'dist/bundle.umd.js',\n              format: 'umd',\n              sourcemap: true\n          }\n      }\n  ];\n#+end_src\n\n~package.json~ の設定も同時に変える必要がある。\n\n[[https://github.com/takeokunn/businesh/blob/master/package.json#L5-L7][takeokunn/businesh/blob/master/package.json]]抜粋。\n\n#+begin_src json\n  {\n      ...\n      \"main\": \"dist/bundle.cjs.js\",\n      \"module\": \"dist/bundle.es.js\",\n      \"browser\": \"dist/bundle.umd.js\",\n      \"repository\": \"git@github.com:takeokunn/businesh.git\",\n      \"author\": \"takeokunn<bararararatty@gmail.com>\",\n      ...\n  }\n#+end_src\n\nこれでうまく ~npm install~ した時よい感じに読み込むことができる。\n\nちなみに、イマイチよい記事がなかったので[[https://github.com/reduxjs/redux/blob/master/package.json][reduxjs/redux]] を参考にした。\n\n--------------\n\n適当に作ったライブラリだったが、 ~build format~ について学べたから良かったかな。\n\nゴミみたいなやつじゃなくて、もっと社会の役に立つようなものを作れるようになりたい（願望）\n",
  "backlinks": []
}